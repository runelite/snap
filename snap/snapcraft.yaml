name: runelite
base: core22
title: RuneLite
version: git
summary: A popular free, open-source and super fast client for Old School RuneScape
description: |
  A popular free, open-source and super fast client for Old School RuneScape

type: app
grade: stable
confinement: strict
icon: snap/gui/runelite.png
license: BSD-2-Clause
compression: lzo

parts:
  adoptopenjdk:
    plugin: dump
    source: https://github.com/adoptium/temurin11-binaries/releases/download/jdk-11.0.18%2B10/OpenJDK11U-jre_x64_linux_hotspot_11.0.18_10.tar.gz
    source-checksum: "sha256/0e7b196ef8603ac3d38caaf7768b7b0a3c613d60e15a6511bcfb2c894b609e99"
    stage-packages:
      - libxi6
      - libxrender1
      - libxtst6

  runelite:
    plugin: nil # Cannot use dump due to limited source-type support
    build-packages: 
      - wget
    stage-packages:
      - libglu1-mesa
      - libpulse0
      - libasound2
      - libasound2-plugins
      - libnotify-bin
    override-pull: |
      wget https://github.com/runelite/launcher/releases/download/2.6.3/RuneLite.jar -O $CRAFT_PART_SRC/RuneLite.jar
      echo "b4db68442950be4a44c07d02debc851dda6e48f66f1969f22cc01b5423097f3c $CRAFT_PART_SRC/RuneLite.jar" | sha256sum --check || exit 1 # Check hash manually, due to nil plugin
    override-build: |
      cp $CRAFT_PART_BUILD/RuneLite.jar $CRAFT_PART_INSTALL/RuneLite.jar
      chmod +x $CRAFT_PART_INSTALL/RuneLite.jar

  alsa-pulseaudio:
    plugin: dump
    source: .
    override-pull: |
      mkdir etc -p
      cat > etc/asound.conf <<EOF
      pcm.!default {
          type pulse
          fallback "sysdefault"
          hint {
              show on
              description "Default ALSA Output (currently PulseAudio Sound Server)"
          }
      }
      ctl.!default {
          type pulse
          fallback "sysdefault"
      }
      EOF

layout:
  /usr/lib/$SNAPCRAFT_ARCH_TRIPLET/alsa-lib:
    bind: $SNAP/usr/lib/$SNAPCRAFT_ARCH_TRIPLET/alsa-lib

apps:
  runelite:
    command: bin/java -jar $SNAP/RuneLite.jar
    plugs:
      - desktop
      - desktop-legacy
      - network
      - audio-playback
      - x11
      - opengl

    extensions: [ gnome ]
    environment:
      _JAVA_OPTIONS: -Duser.home="$SNAP_USER_COMMON"
      ALSA_CONFIG_PATH: "$SNAP/etc/asound.conf"
